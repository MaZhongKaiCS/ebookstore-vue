{"remainingRequest":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!/Users/mazhongkai/Desktop/ebook 2/vue-ebook/src/components/ebook/EbookBookmark.vue?vue&type=style&index=0&id=2f8f9523&lang=scss&rel=stylesheet%2Fscss&scoped=true&","dependencies":[{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/src/components/ebook/EbookBookmark.vue","mtime":1579925468000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_css-loader@1.0.1@css-loader/index.js","mtime":499162500000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_sass-loader@7.3.1@sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import \"../../assets/styles/global\";\n\n.ebook-bookmark {\n  position: absolute;\n  top: px2rem(-35);\n  left: 0;\n  z-index: 200;\n  width: 100%;\n  height: px2rem(35);\n  .ebook-bookmark-text-wrapper {\n    position: absolute;\n    right: px2rem(45);\n    bottom: 0;\n    display: flex;\n    .ebook-bookmark-down-wrapper {\n      font-size: px2rem(14);\n      color: white;\n      transition: all .2s linear;\n      @include center;\n    }\n    .ebook-bookmark-text {\n      font-size: px2rem(14);\n      color: white;\n    }\n  }\n  .ebook-bookmark-icon-wrapper {\n    position: absolute;\n    right: 0;\n    bottom: 0;\n    margin-right: px2rem(15);\n  }\n}\n",{"version":3,"sources":["EbookBookmark.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgKA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookBookmark.vue","sourceRoot":"src/components/ebook","sourcesContent":["<template>\n  <div class=\"ebook-bookmark\" ref=\"bookmark\">\n    <div class=\"ebook-bookmark-text-wrapper\">\n      <div class=\"ebook-bookmark-down-wrapper\" ref=\"iconDown\">\n        <span class=\"icon-down\"></span>\n      </div>\n      <div class=\"ebook-bookmark-text\">{{text}}</div>\n    </div>\n    <div class=\"ebook-bookmark-icon-wrapper\" :style=\"isFixed ? fixedStyle : {}\">\n      <bookmark :color=\"color\" :width=\"15\" :height=\"35\"></bookmark>\n    </div>\n  </div>\n</template>\n\n<script>\n  import { realPx } from '../../utils/utils'\n  import Bookmark from '../common/Bookmark'\n  import { ebookMixin } from '../../utils/mixin'\n  import { getBookmark, saveBookmark } from '../../utils/localStorage'\n\n  const BLUE = '#346cbc'\n  const WHITE = '#fff'\n  export default {\n    mixins: [ebookMixin],\n    components: {\n      Bookmark\n    },\n    computed: {\n      height() {\n        return realPx(35)\n      },\n      threshold() {\n        return realPx(55)\n      },\n      fixedStyle() {\n        return {\n          position: 'fixed',\n          top: 0,\n          right: `${(window.innerWidth - this.$refs.bookmark.clientWidth) / 2}px`\n        }\n      }\n    },\n    watch: {\n      offsetY(v) {\n        if (!this.bookAvailable || this.menuVisible || this.settingVisible >= 0) {\n          return\n        }\n        if (v >= this.height && v < this.threshold) {\n          this.beforeThreshold(v)\n        } else if (v >= this.threshold) {\n          this.afterThreshold(v)\n        } else if (v > 0 && v < this.height) {\n          this.beforeHeight()\n        } else if (v === 0) {\n          this.restore()\n        }\n      },\n      isBookmark(isBookmark) {\n        this.isFixed = isBookmark\n        if (isBookmark) {\n          this.color = BLUE\n        } else {\n          this.color = WHITE\n        }\n      }\n    },\n    data() {\n      return {\n        text: '',\n        color: WHITE,\n        isFixed: false\n      }\n    },\n    methods: {\n      addBookmark() {\n        this.bookmark = getBookmark(this.fileName)\n        if (!this.bookmark) {\n          this.bookmark = []\n        }\n        const currentLocation = this.currentBook.rendition.currentLocation()\n        const cfibase = currentLocation.start.cfi.replace(/!.*/, '')\n        const cfistart = currentLocation.start.cfi.replace(/.*!/, '').replace(/\\)$/, '')\n        const cfiend = currentLocation.end.cfi.replace(/.*!/, '').replace(/\\)$/, '')\n        const cfirange = `${cfibase}!,${cfistart},${cfiend})`\n        this.currentBook.getRange(cfirange).then(range => {\n          const text = range.toString().replace(/\\s\\s/g, '')\n          this.bookmark.push({\n            cfi: currentLocation.start.cfi,\n            text: text\n          })\n          saveBookmark(this.fileName, this.bookmark)\n        })\n      },\n      removeBookmark() {\n        const currentLocation = this.currentBook.rendition.currentLocation()\n        const cfi = currentLocation.start.cfi\n        this.bookmark = getBookmark(this.fileName)\n        if (this.bookmark) {\n          saveBookmark(this.fileName, this.bookmark.filter(item => item.cfi !== cfi))\n          this.setIsBookmark(false)\n        }\n      },\n      restore() {\n        // 状态4：归位\n        setTimeout(() => {\n          this.$refs.bookmark.style.top = `${-this.height}px`\n          this.$refs.iconDown.style.transform = 'rotate(0deg)'\n        }, 200)\n        if (this.isFixed) {\n          this.setIsBookmark(true)\n          this.addBookmark()\n        } else {\n          this.setIsBookmark(false)\n          this.removeBookmark()\n        }\n      },\n      beforeHeight() {\n        // 状态1：未超过书签的高度\n        if (this.isBookmark) {\n          this.text = this.$t('book.pulldownDeleteMark')\n          this.color = BLUE\n          this.isFixed = true\n        } else {\n          this.text = this.$t('book.pulldownAddMark')\n          this.color = WHITE\n          this.isFixed = false\n        }\n      },\n      beforeThreshold(v) {\n        // 状态2：未到达零界状态\n        this.$refs.bookmark.style.top = `${-v}px`\n        this.beforeHeight()\n        const iconDown = this.$refs.iconDown\n        if (iconDown.style.transform === 'rotate(180deg)') {\n          iconDown.style.transform = 'rotate(0deg)'\n        }\n      },\n      afterThreshold(v) {\n        // 状态3：超越零界状态\n        this.$refs.bookmark.style.top = `${-v}px`\n        if (this.isBookmark) {\n          this.text = this.$t('book.releaseDeleteMark')\n          this.color = WHITE\n          this.isFixed = false\n        } else {\n          this.text = this.$t('book.releaseAddMark')\n          this.color = BLUE\n          this.isFixed = true\n        }\n        const iconDown = this.$refs.iconDown\n        if (iconDown.style.transform === '' ||\n          iconDown.style.transform === 'rotate(0deg)') {\n          iconDown.style.transform = 'rotate(180deg)'\n        }\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\n  @import \"../../assets/styles/global\";\n\n  .ebook-bookmark {\n    position: absolute;\n    top: px2rem(-35);\n    left: 0;\n    z-index: 200;\n    width: 100%;\n    height: px2rem(35);\n    .ebook-bookmark-text-wrapper {\n      position: absolute;\n      right: px2rem(45);\n      bottom: 0;\n      display: flex;\n      .ebook-bookmark-down-wrapper {\n        font-size: px2rem(14);\n        color: white;\n        transition: all .2s linear;\n        @include center;\n      }\n      .ebook-bookmark-text {\n        font-size: px2rem(14);\n        color: white;\n      }\n    }\n    .ebook-bookmark-icon-wrapper {\n      position: absolute;\n      right: 0;\n      bottom: 0;\n      margin-right: px2rem(15);\n    }\n  }\n</style>\n"]}]}