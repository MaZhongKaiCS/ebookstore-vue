{"remainingRequest":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js!/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!/Users/mazhongkai/Desktop/ebook 2/vue-ebook/src/components/ebook/EbookBookmark.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/src/components/ebook/EbookBookmark.vue","mtime":1579925468000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.regexp.replace\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { realPx } from \"../../utils/utils\";\nimport Bookmark from \"../common/Bookmark\";\nimport { ebookMixin } from \"../../utils/mixin\";\nimport { getBookmark, saveBookmark } from \"../../utils/localStorage\";\nvar BLUE = '#346cbc';\nvar WHITE = '#fff';\nexport default {\n  mixins: [ebookMixin],\n  components: {\n    Bookmark: Bookmark\n  },\n  computed: {\n    height: function height() {\n      return realPx(35);\n    },\n    threshold: function threshold() {\n      return realPx(55);\n    },\n    fixedStyle: function fixedStyle() {\n      return {\n        position: 'fixed',\n        top: 0,\n        right: \"\".concat((window.innerWidth - this.$refs.bookmark.clientWidth) / 2, \"px\")\n      };\n    }\n  },\n  watch: {\n    offsetY: function offsetY(v) {\n      if (!this.bookAvailable || this.menuVisible || this.settingVisible >= 0) {\n        return;\n      }\n\n      if (v >= this.height && v < this.threshold) {\n        this.beforeThreshold(v);\n      } else if (v >= this.threshold) {\n        this.afterThreshold(v);\n      } else if (v > 0 && v < this.height) {\n        this.beforeHeight();\n      } else if (v === 0) {\n        this.restore();\n      }\n    },\n    isBookmark: function isBookmark(_isBookmark) {\n      this.isFixed = _isBookmark;\n\n      if (_isBookmark) {\n        this.color = BLUE;\n      } else {\n        this.color = WHITE;\n      }\n    }\n  },\n  data: function data() {\n    return {\n      text: '',\n      color: WHITE,\n      isFixed: false\n    };\n  },\n  methods: {\n    addBookmark: function addBookmark() {\n      var _this = this;\n\n      this.bookmark = getBookmark(this.fileName);\n\n      if (!this.bookmark) {\n        this.bookmark = [];\n      }\n\n      var currentLocation = this.currentBook.rendition.currentLocation();\n      var cfibase = currentLocation.start.cfi.replace(/!.*/, '');\n      var cfistart = currentLocation.start.cfi.replace(/.*!/, '').replace(/\\)$/, '');\n      var cfiend = currentLocation.end.cfi.replace(/.*!/, '').replace(/\\)$/, '');\n      var cfirange = \"\".concat(cfibase, \"!,\").concat(cfistart, \",\").concat(cfiend, \")\");\n      this.currentBook.getRange(cfirange).then(function (range) {\n        var text = range.toString().replace(/\\s\\s/g, '');\n\n        _this.bookmark.push({\n          cfi: currentLocation.start.cfi,\n          text: text\n        });\n\n        saveBookmark(_this.fileName, _this.bookmark);\n      });\n    },\n    removeBookmark: function removeBookmark() {\n      var currentLocation = this.currentBook.rendition.currentLocation();\n      var cfi = currentLocation.start.cfi;\n      this.bookmark = getBookmark(this.fileName);\n\n      if (this.bookmark) {\n        saveBookmark(this.fileName, this.bookmark.filter(function (item) {\n          return item.cfi !== cfi;\n        }));\n        this.setIsBookmark(false);\n      }\n    },\n    restore: function restore() {\n      var _this2 = this;\n\n      // 状态4：归位\n      setTimeout(function () {\n        _this2.$refs.bookmark.style.top = \"\".concat(-_this2.height, \"px\");\n        _this2.$refs.iconDown.style.transform = 'rotate(0deg)';\n      }, 200);\n\n      if (this.isFixed) {\n        this.setIsBookmark(true);\n        this.addBookmark();\n      } else {\n        this.setIsBookmark(false);\n        this.removeBookmark();\n      }\n    },\n    beforeHeight: function beforeHeight() {\n      // 状态1：未超过书签的高度\n      if (this.isBookmark) {\n        this.text = this.$t('book.pulldownDeleteMark');\n        this.color = BLUE;\n        this.isFixed = true;\n      } else {\n        this.text = this.$t('book.pulldownAddMark');\n        this.color = WHITE;\n        this.isFixed = false;\n      }\n    },\n    beforeThreshold: function beforeThreshold(v) {\n      // 状态2：未到达零界状态\n      this.$refs.bookmark.style.top = \"\".concat(-v, \"px\");\n      this.beforeHeight();\n      var iconDown = this.$refs.iconDown;\n\n      if (iconDown.style.transform === 'rotate(180deg)') {\n        iconDown.style.transform = 'rotate(0deg)';\n      }\n    },\n    afterThreshold: function afterThreshold(v) {\n      // 状态3：超越零界状态\n      this.$refs.bookmark.style.top = \"\".concat(-v, \"px\");\n\n      if (this.isBookmark) {\n        this.text = this.$t('book.releaseDeleteMark');\n        this.color = WHITE;\n        this.isFixed = false;\n      } else {\n        this.text = this.$t('book.releaseAddMark');\n        this.color = BLUE;\n        this.isFixed = true;\n      }\n\n      var iconDown = this.$refs.iconDown;\n\n      if (iconDown.style.transform === '' || iconDown.style.transform === 'rotate(0deg)') {\n        iconDown.style.transform = 'rotate(180deg)';\n      }\n    }\n  }\n};",{"version":3,"sources":["EbookBookmark.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"ebook-bookmark\" ref=\"bookmark\">\n    <div class=\"ebook-bookmark-text-wrapper\">\n      <div class=\"ebook-bookmark-down-wrapper\" ref=\"iconDown\">\n        <span class=\"icon-down\"></span>\n      </div>\n      <div class=\"ebook-bookmark-text\">{{text}}</div>\n    </div>\n    <div class=\"ebook-bookmark-icon-wrapper\" :style=\"isFixed ? fixedStyle : {}\">\n      <bookmark :color=\"color\" :width=\"15\" :height=\"35\"></bookmark>\n    </div>\n  </div>\n</template>\n\n<script>\n  import { realPx } from '../../utils/utils'\n  import Bookmark from '../common/Bookmark'\n  import { ebookMixin } from '../../utils/mixin'\n  import { getBookmark, saveBookmark } from '../../utils/localStorage'\n\n  const BLUE = '#346cbc'\n  const WHITE = '#fff'\n  export default {\n    mixins: [ebookMixin],\n    components: {\n      Bookmark\n    },\n    computed: {\n      height() {\n        return realPx(35)\n      },\n      threshold() {\n        return realPx(55)\n      },\n      fixedStyle() {\n        return {\n          position: 'fixed',\n          top: 0,\n          right: `${(window.innerWidth - this.$refs.bookmark.clientWidth) / 2}px`\n        }\n      }\n    },\n    watch: {\n      offsetY(v) {\n        if (!this.bookAvailable || this.menuVisible || this.settingVisible >= 0) {\n          return\n        }\n        if (v >= this.height && v < this.threshold) {\n          this.beforeThreshold(v)\n        } else if (v >= this.threshold) {\n          this.afterThreshold(v)\n        } else if (v > 0 && v < this.height) {\n          this.beforeHeight()\n        } else if (v === 0) {\n          this.restore()\n        }\n      },\n      isBookmark(isBookmark) {\n        this.isFixed = isBookmark\n        if (isBookmark) {\n          this.color = BLUE\n        } else {\n          this.color = WHITE\n        }\n      }\n    },\n    data() {\n      return {\n        text: '',\n        color: WHITE,\n        isFixed: false\n      }\n    },\n    methods: {\n      addBookmark() {\n        this.bookmark = getBookmark(this.fileName)\n        if (!this.bookmark) {\n          this.bookmark = []\n        }\n        const currentLocation = this.currentBook.rendition.currentLocation()\n        const cfibase = currentLocation.start.cfi.replace(/!.*/, '')\n        const cfistart = currentLocation.start.cfi.replace(/.*!/, '').replace(/\\)$/, '')\n        const cfiend = currentLocation.end.cfi.replace(/.*!/, '').replace(/\\)$/, '')\n        const cfirange = `${cfibase}!,${cfistart},${cfiend})`\n        this.currentBook.getRange(cfirange).then(range => {\n          const text = range.toString().replace(/\\s\\s/g, '')\n          this.bookmark.push({\n            cfi: currentLocation.start.cfi,\n            text: text\n          })\n          saveBookmark(this.fileName, this.bookmark)\n        })\n      },\n      removeBookmark() {\n        const currentLocation = this.currentBook.rendition.currentLocation()\n        const cfi = currentLocation.start.cfi\n        this.bookmark = getBookmark(this.fileName)\n        if (this.bookmark) {\n          saveBookmark(this.fileName, this.bookmark.filter(item => item.cfi !== cfi))\n          this.setIsBookmark(false)\n        }\n      },\n      restore() {\n        // 状态4：归位\n        setTimeout(() => {\n          this.$refs.bookmark.style.top = `${-this.height}px`\n          this.$refs.iconDown.style.transform = 'rotate(0deg)'\n        }, 200)\n        if (this.isFixed) {\n          this.setIsBookmark(true)\n          this.addBookmark()\n        } else {\n          this.setIsBookmark(false)\n          this.removeBookmark()\n        }\n      },\n      beforeHeight() {\n        // 状态1：未超过书签的高度\n        if (this.isBookmark) {\n          this.text = this.$t('book.pulldownDeleteMark')\n          this.color = BLUE\n          this.isFixed = true\n        } else {\n          this.text = this.$t('book.pulldownAddMark')\n          this.color = WHITE\n          this.isFixed = false\n        }\n      },\n      beforeThreshold(v) {\n        // 状态2：未到达零界状态\n        this.$refs.bookmark.style.top = `${-v}px`\n        this.beforeHeight()\n        const iconDown = this.$refs.iconDown\n        if (iconDown.style.transform === 'rotate(180deg)') {\n          iconDown.style.transform = 'rotate(0deg)'\n        }\n      },\n      afterThreshold(v) {\n        // 状态3：超越零界状态\n        this.$refs.bookmark.style.top = `${-v}px`\n        if (this.isBookmark) {\n          this.text = this.$t('book.releaseDeleteMark')\n          this.color = WHITE\n          this.isFixed = false\n        } else {\n          this.text = this.$t('book.releaseAddMark')\n          this.color = BLUE\n          this.isFixed = true\n        }\n        const iconDown = this.$refs.iconDown\n        if (iconDown.style.transform === '' ||\n          iconDown.style.transform === 'rotate(0deg)') {\n          iconDown.style.transform = 'rotate(180deg)'\n        }\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\n  @import \"../../assets/styles/global\";\n\n  .ebook-bookmark {\n    position: absolute;\n    top: px2rem(-35);\n    left: 0;\n    z-index: 200;\n    width: 100%;\n    height: px2rem(35);\n    .ebook-bookmark-text-wrapper {\n      position: absolute;\n      right: px2rem(45);\n      bottom: 0;\n      display: flex;\n      .ebook-bookmark-down-wrapper {\n        font-size: px2rem(14);\n        color: white;\n        transition: all .2s linear;\n        @include center;\n      }\n      .ebook-bookmark-text {\n        font-size: px2rem(14);\n        color: white;\n      }\n    }\n    .ebook-bookmark-icon-wrapper {\n      position: absolute;\n      right: 0;\n      bottom: 0;\n      margin-right: px2rem(15);\n    }\n  }\n</style>\n"],"sourceRoot":"src/components/ebook"}]}