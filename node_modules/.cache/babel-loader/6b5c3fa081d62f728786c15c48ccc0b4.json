{"remainingRequest":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js!/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!/Users/mazhongkai/Desktop/ebook 2/vue-ebook/src/components/ebook/EbookReader.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/src/components/ebook/EbookReader.vue","mtime":1627017774869},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mazhongkai/Desktop/ebook 2/vue-ebook/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n// 使用 mapGetters 来快速调用 vuex 中的对象\n// import { mapGetters } from 'vuex'\n// 引入 mixin.js 来代替 mapGetter mapActions（mixin.js 集中管理 mapGetters）\nimport { ebookMixin } from \"../../utils/mixin\"; // 使用 mapActions 原理跟 mapGetters 差不多，mapActions是引入定义在vuex 中 actios 或者是独立出来的 actions.js 中的方法\n// 还是跟 mapGetters 一样，放入到 mixin.js 中集中管理\n// import { mapActions } from 'vuex'\n// 引入本次项目的核心 Epubjs\n\nimport Epub from 'epubjs'; // 引入 book.js 中的 addCss 方法来帮助改变全局样式 initGlobalStyle(),由于需要在多个组件中使用，所以后期移入 mixin.js 中\n// import { addCss } from '../../utils/book';\n// 有关本地缓存的文件\n\nimport { getFontFamily, getFontSize, getLocation, getTheme, saveFontFamily, saveFontSize, saveTheme } from \"../../utils/localStorage\";\nglobal.ePub = Epub;\nexport default {\n  // 使用 mixins 方法来引用引入进来的 mixin.js 中的自定义对象\n  mixins: [ebookMixin],\n  methods: {\n    // 使用 mapActions 来引入 actios.js 中的方法, 引入之后就可以直接使用 this.xx() 来使用xx方法\n    // 还是跟 mapGetters 一样，放入到 mixin.js 中集中管理\n    // ...mapActions(['setMenuVisible']),\n    // 向前翻页事件\n    prevPage: function prevPage() {\n      var _this = this;\n\n      //  首先判断电子书是否存在，然后再执行\n      if (this.rendition) {\n        this.rendition.prev().then(function () {\n          _this.refreshLocation();\n        }); // 引用 hideTitleAndMenu 方法来实现翻页隐藏菜单栏\n\n        this.hideTitleAndMenu();\n      }\n    },\n    // 向后翻页事件\n    nextPage: function nextPage() {\n      var _this2 = this;\n\n      if (this.rendition) {\n        this.rendition.next().then(function () {\n          _this2.refreshLocation();\n        });\n        this.hideTitleAndMenu();\n      }\n    },\n    // 弹出菜单栏事件事件,通过 $store.dispatch 来调用在vuex 中定义的方法 setMenuVisible，后面引入了 mapActions 来引入方法，使用方法更加便捷。\n    // 将 actions 独立出来形成 actions.js 文件，使用 mixin.js 文件进行集中引入，最后引入 mixin.js 即可\n    toggleTitleAndMenu: function toggleTitleAndMenu() {\n      this.setMenuVisible(!this.menuVisible); // 在 toggleTitleAndMenu 事件触发时，如果 menu 弹出，则字体 SettingFont 不展示，直到点击触发 SetSettingVisible事件才弹出字号设置窗口\n\n      if (this.menuVisible) {\n        this.setSettingVisible(-1);\n      }\n\n      this.setFontFamilyVisible(false);\n    },\n    hideTitleAndMenu: function hideTitleAndMenu() {\n      this.setMenuVisible(false); // 需求：隐藏菜单栏时，也同时收起 调节字号的菜单（EbookSettingFont）\n\n      this.setSettingVisible(-1); // 需求：隐藏菜单栏时，也同时收起  font-family 弹出层\n\n      this.setFontFamilyVisible(false);\n    },\n    // 缓存的思路：在 localStorage.js 中定义 get 和 save 方法，先获取页面中的xxx，判断是否含有 xxx，如果没有，则获取 xxx 并保存 save（xxx），如果有，则改变页面的 xxx 属性，并且设置为默认为了缓存\n    // 缓存字号大小的方法，在 initEpub 方法中渲染出电子书后进行引用,\n    initFontSize: function initFontSize() {\n      var fontSize = getFontSize(this.fileName);\n\n      if (!fontSize) {\n        saveFontSize(this.fileName, this.defaultFontSize);\n      } else {\n        this.rendition.themes.fontSize(fontSize);\n        this.setDefaultFontSize(fontSize);\n      }\n    },\n    // 缓存字体风格的方法，在 initEpub 方法中渲染出电子书后进行引用\n    initFontFamily: function initFontFamily() {\n      var fontFamily = getFontFamily(this.fileName);\n\n      if (!fontFamily) {\n        saveFontFamily(this.fileName, this.defaultFontFamily);\n      } else {\n        this.rendition.themes.font(fontFamily);\n        this.setDefaultFontFamily(fontFamily);\n      }\n    },\n    // 缓存主题的方法，在 initEpub 方法中渲染出电子书后进行引用\n    initTheme: function initTheme() {\n      var _this3 = this;\n\n      var defaultTheme = getTheme(this.fileName);\n\n      if (!defaultTheme) {\n        defaultTheme = this.themeList[0].name;\n        saveTheme(this.fileName, defaultTheme);\n      }\n\n      this.setDefaultTheme(defaultTheme);\n      this.themeList.forEach(function (theme) {\n        _this3.rendition.themes.register(theme.name, theme.style);\n      });\n      this.rendition.themes.select(defaultTheme);\n    },\n    // 渲染电子书的方法\n    initRendition: function initRendition() {\n      var _this4 = this;\n\n      this.rendition = this.book.renderTo('read', {\n        width: innerWidth,\n        height: innerHeight,\n        //  加入微信的兼容性配置\n        // 由于部分的浏览器无法显示 把 epubjs 的版本改为0.3.71   cnpm i epubjs@0.3.71\n        method: 'default'\n      }); // 渲染电子书,并且添加一次初始化的渲染，记录下初始化的默认字体\\字号\\主题\n\n      var location = getLocation(this.fileName);\n      this.display(location, function () {\n        _this4.initTheme();\n\n        _this4.initFontFamily();\n\n        _this4.initFontSize();\n\n        _this4.initGlobalStyle();\n      });\n      this.rendition.hooks.content.register(function (contents) {\n        Promise.all([// 当加入来自.env.development 文件中的VUE_APP_RES_URL后，需要将整个程序重新加载一遍才能够看到效果\n        contents.addStylesheet(\"\".concat(process.env.VUE_APP_RES_URL, \"/fonts/daysOne.css\")), contents.addStylesheet(\"\".concat(process.env.VUE_APP_RES_URL, \"/fonts/cabin.css\")), contents.addStylesheet(\"\".concat(process.env.VUE_APP_RES_URL, \"/fonts/montserrat.css\")), contents.addStylesheet(\"\".concat(process.env.VUE_APP_RES_URL, \"/fonts/tangerine.css\"))]).then(function () {});\n      });\n    },\n    // 手势方法\n    initGesture: function initGesture() {\n      var _this5 = this;\n\n      // 给电子书绑定屏幕的手势事件 touchstart ：触摸屏幕事件  touchend：离开屏幕事件\n      // 事件内部有属性可以操作，其中是 timeStamp可以用于认定长按属于无效操作，changedTouches 里面的第一个属性为 判断几根手指的操作，\n      // 第一个属性内部的 clientX 为水平方向的移动（根据变化来判断向左还是向右划动）\n      this.rendition.on('touchstart', function (event) {\n        _this5.touchstartX = event.changedTouches[0].clientX;\n        _this5.touchstartTime = event.timeStamp;\n      });\n      this.rendition.on('touchend', function (event) {\n        var offsetX = event.changedTouches[0].clientX - _this5.touchstartX;\n        var time = event.timeStamp - _this5.touchstartTime; // console.log(offsetX, time);\n        // 需求：手指操作的事件不能大于 500 毫秒，划动的距离要大于 40\n\n        if (time < 500 && offsetX > 40) {\n          _this5.prevPage();\n        } else if (time < 500 && offsetX < -40) {\n          _this5.nextPage();\n        } else {\n          _this5.toggleTitleAndMenu();\n        } // // 禁止事件的默认方法调用和传播\n\n\n        if (event.preventDefault) {\n          event.preventDefault();\n        }\n\n        event.stopPropagation();\n      });\n    },\n    initEpub: function initEpub() {\n      var _this6 = this;\n\n      // 坑：之前设置 Nginx 时设置端口号为 8081\n      var url = process.env.VUE_APP_RES_URL + '/epub/' + this.fileName + '.epub'; // console.log(url);\n\n      this.book = new Epub(url);\n      this.setCurrentBook(this.book);\n      this.initRendition();\n      this.initGesture(); // 在电子书全部解析之后调用 ready\n\n      this.book.ready.then(function () {\n        return _this6.book.locations.generate(750 * (window.innerWidth / 375) * (getFontSize(_this6.fileName) / 16));\n      }).then(function () {\n        _this6.setBookAvailable(true);\n\n        _this6.refreshLocation();\n      });\n    }\n  },\n  // 使用生命周期函数中的 mounted 方法来获取动态路由 router.params.fileName\n  mounted: function mounted() {\n    var _this7 = this;\n\n    // const fileName = this.$route.params.fileName\n    // console.log(fileName);\n    // split 方法：以 xxx 为界限划分获取的结果\n    // join 方法：以 xxx 将获取的结果合并在一起\n    // const baseUrl = 'http://192.168.31.133:8081/epub/'\n    // const fileName = this.$route.params.fileName.split('|').join('/')\n    this.setFileName(this.$route.params.fileName.split('|').join('/')).then(function () {\n      _this7.initEpub();\n    });\n  }\n};",{"version":3,"sources":["EbookReader.vue"],"names":[],"mappings":"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","sourcesContent":["<!--用于接收动态路由的组件-->\n<template>\n  <div class=\"ebook-reader\">\n    <div id=\"read\"></div>\n  </div>\n</template>\n\n<script>\n// 使用 mapGetters 来快速调用 vuex 中的对象\n// import { mapGetters } from 'vuex'\n// 引入 mixin.js 来代替 mapGetter mapActions（mixin.js 集中管理 mapGetters）\nimport { ebookMixin } from '../../utils/mixin';\n// 使用 mapActions 原理跟 mapGetters 差不多，mapActions是引入定义在vuex 中 actios 或者是独立出来的 actions.js 中的方法\n// 还是跟 mapGetters 一样，放入到 mixin.js 中集中管理\n// import { mapActions } from 'vuex'\n// 引入本次项目的核心 Epubjs\nimport Epub from 'epubjs';\n// 引入 book.js 中的 addCss 方法来帮助改变全局样式 initGlobalStyle(),由于需要在多个组件中使用，所以后期移入 mixin.js 中\n// import { addCss } from '../../utils/book';\n// 有关本地缓存的文件\nimport {\n  getFontFamily,\n  getFontSize,\n  getLocation,\n  getTheme,\n  saveFontFamily,\n  saveFontSize,\n  saveTheme\n} from '../../utils/localStorage';\nglobal.ePub = Epub;\n\nexport default {\n  // 使用 mixins 方法来引用引入进来的 mixin.js 中的自定义对象\n  mixins: [ebookMixin],\n  methods: {\n    // 使用 mapActions 来引入 actios.js 中的方法, 引入之后就可以直接使用 this.xx() 来使用xx方法\n    // 还是跟 mapGetters 一样，放入到 mixin.js 中集中管理\n    // ...mapActions(['setMenuVisible']),\n    // 向前翻页事件\n    prevPage() {\n      //  首先判断电子书是否存在，然后再执行\n      if (this.rendition) {\n        this.rendition.prev().then(() => {\n          this.refreshLocation();\n        });\n        // 引用 hideTitleAndMenu 方法来实现翻页隐藏菜单栏\n        this.hideTitleAndMenu();\n      }\n    },\n    // 向后翻页事件\n    nextPage() {\n      if (this.rendition) {\n        this.rendition.next().then(() => {\n          this.refreshLocation();\n        });\n        this.hideTitleAndMenu();\n      }\n    },\n    // 弹出菜单栏事件事件,通过 $store.dispatch 来调用在vuex 中定义的方法 setMenuVisible，后面引入了 mapActions 来引入方法，使用方法更加便捷。\n    // 将 actions 独立出来形成 actions.js 文件，使用 mixin.js 文件进行集中引入，最后引入 mixin.js 即可\n    toggleTitleAndMenu() {\n      this.setMenuVisible(!this.menuVisible);\n      // 在 toggleTitleAndMenu 事件触发时，如果 menu 弹出，则字体 SettingFont 不展示，直到点击触发 SetSettingVisible事件才弹出字号设置窗口\n      if (this.menuVisible) {\n        this.setSettingVisible(-1);\n      }\n      this.setFontFamilyVisible(false);\n    },\n    hideTitleAndMenu() {\n      this.setMenuVisible(false);\n      // 需求：隐藏菜单栏时，也同时收起 调节字号的菜单（EbookSettingFont）\n      this.setSettingVisible(-1);\n      // 需求：隐藏菜单栏时，也同时收起  font-family 弹出层\n      this.setFontFamilyVisible(false);\n    },\n    // 缓存的思路：在 localStorage.js 中定义 get 和 save 方法，先获取页面中的xxx，判断是否含有 xxx，如果没有，则获取 xxx 并保存 save（xxx），如果有，则改变页面的 xxx 属性，并且设置为默认为了缓存\n    // 缓存字号大小的方法，在 initEpub 方法中渲染出电子书后进行引用,\n    initFontSize() {\n      const fontSize = getFontSize(this.fileName);\n      if (!fontSize) {\n        saveFontSize(this.fileName, this.defaultFontSize);\n      } else {\n        this.rendition.themes.fontSize(fontSize);\n        this.setDefaultFontSize(fontSize);\n      }\n    },\n    // 缓存字体风格的方法，在 initEpub 方法中渲染出电子书后进行引用\n    initFontFamily() {\n      const fontFamily = getFontFamily(this.fileName);\n      if (!fontFamily) {\n        saveFontFamily(this.fileName, this.defaultFontFamily);\n      } else {\n        this.rendition.themes.font(fontFamily);\n        this.setDefaultFontFamily(fontFamily);\n      }\n    },\n    // 缓存主题的方法，在 initEpub 方法中渲染出电子书后进行引用\n    initTheme() {\n      let defaultTheme = getTheme(this.fileName);\n      if (!defaultTheme) {\n        defaultTheme = this.themeList[0].name;\n        saveTheme(this.fileName, defaultTheme);\n      }\n      this.setDefaultTheme(defaultTheme);\n      this.themeList.forEach((theme) => {\n        this.rendition.themes.register(theme.name, theme.style);\n      });\n      this.rendition.themes.select(defaultTheme);\n    },\n    // 渲染电子书的方法\n    initRendition() {\n      this.rendition = this.book.renderTo('read', {\n        width: innerWidth,\n        height: innerHeight,\n        //  加入微信的兼容性配置\n        // 由于部分的浏览器无法显示 把 epubjs 的版本改为0.3.71   cnpm i epubjs@0.3.71\n        method: 'default'\n      });\n      // 渲染电子书,并且添加一次初始化的渲染，记录下初始化的默认字体\\字号\\主题\n      const location = getLocation(this.fileName);\n      this.display(location, () => {\n        this.initTheme();\n        this.initFontFamily();\n        this.initFontSize();\n        this.initGlobalStyle();\n      });\n      this.rendition.hooks.content.register((contents) => {\n        Promise.all([\n          // 当加入来自.env.development 文件中的VUE_APP_RES_URL后，需要将整个程序重新加载一遍才能够看到效果\n          contents.addStylesheet(\n            `${process.env.VUE_APP_RES_URL}/fonts/daysOne.css`\n          ),\n          contents.addStylesheet(\n            `${process.env.VUE_APP_RES_URL}/fonts/cabin.css`\n          ),\n          contents.addStylesheet(\n            `${process.env.VUE_APP_RES_URL}/fonts/montserrat.css`\n          ),\n          contents.addStylesheet(\n            `${process.env.VUE_APP_RES_URL}/fonts/tangerine.css`\n          )\n        ]).then(() => {});\n      });\n    },\n    // 手势方法\n    initGesture() {\n      // 给电子书绑定屏幕的手势事件 touchstart ：触摸屏幕事件  touchend：离开屏幕事件\n      // 事件内部有属性可以操作，其中是 timeStamp可以用于认定长按属于无效操作，changedTouches 里面的第一个属性为 判断几根手指的操作，\n      // 第一个属性内部的 clientX 为水平方向的移动（根据变化来判断向左还是向右划动）\n      this.rendition.on('touchstart', (event) => {\n        this.touchstartX = event.changedTouches[0].clientX;\n        this.touchstartTime = event.timeStamp;\n      });\n      this.rendition.on('touchend', (event) => {\n        const offsetX = event.changedTouches[0].clientX - this.touchstartX;\n        const time = event.timeStamp - this.touchstartTime;\n        // console.log(offsetX, time);\n        // 需求：手指操作的事件不能大于 500 毫秒，划动的距离要大于 40\n        if (time < 500 && offsetX > 40) {\n          this.prevPage();\n        } else if (time < 500 && offsetX < -40) {\n          this.nextPage();\n        } else {\n          this.toggleTitleAndMenu();\n        }\n        // // 禁止事件的默认方法调用和传播\n        if (event.preventDefault) {\n          event.preventDefault();\n        }\n        event.stopPropagation();\n      });\n    },\n    initEpub() {\n      // 坑：之前设置 Nginx 时设置端口号为 8081\n      const url =\n        process.env.VUE_APP_RES_URL + '/epub/' + this.fileName + '.epub';\n      // console.log(url);\n      this.book = new Epub(url);\n      this.setCurrentBook(this.book);\n      this.initRendition();\n      this.initGesture();\n      // 在电子书全部解析之后调用 ready\n      this.book.ready\n        .then(() => {\n          return this.book.locations.generate(\n            750 * (window.innerWidth / 375) * (getFontSize(this.fileName) / 16)\n          );\n        })\n        .then(() => {\n          this.setBookAvailable(true);\n          this.refreshLocation();\n        });\n    }\n  },\n  // 使用生命周期函数中的 mounted 方法来获取动态路由 router.params.fileName\n  mounted() {\n    // const fileName = this.$route.params.fileName\n    // console.log(fileName);\n    // split 方法：以 xxx 为界限划分获取的结果\n    // join 方法：以 xxx 将获取的结果合并在一起\n    // const baseUrl = 'http://192.168.31.133:8081/epub/'\n    // const fileName = this.$route.params.fileName.split('|').join('/')\n    this.setFileName(this.$route.params.fileName.split('|').join('/')).then(\n      () => {\n        this.initEpub();\n      }\n    );\n  }\n};\n</script>\n\n<style scoped>\n</style>\n"],"sourceRoot":"src/components/ebook"}]}